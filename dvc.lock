schema: '2.0'
stages:
  ingest_data:
    cmd:
    - curl -o data/raw/train.parquet https://d37ci6vzurychx.cloudfront.net/trip-data/yellow_tripdata_2023-01.parquet
    - curl -o data/raw/test.parquet https://d37ci6vzurychx.cloudfront.net/trip-data/yellow_tripdata_2023-02.parquet
    params:
      params.yaml:
        base:
          log_level: INFO
          raw_data_path: data/raw
          temp_data_path: data/temp
          processed_data_path: data/processed
        download:
          train_dataset: 2023-01
          test_dataset: 2023-02
          url_prefix: https://d37ci6vzurychx.cloudfront.net/trip-data/yellow_tripdata_
    outs:
    - path: data/raw/test.parquet
      md5: f01f2456ef459b33477ee73b4c2ced24
      size: 47748012
    - path: data/raw/train.parquet
      md5: d2de0ffc4f9112b91c5fe3a407c07435
      size: 47673370
  data_load:
    cmd: python src/data_load.py --config params.yaml
    deps:
    - path: data/raw
      md5: 8388f4cd6730d3e5a6edc437aef08dc5.dir
      size: 95421411
      nfiles: 3
    - path: src/data_load.py
      md5: 24f735d2168238472f2d49e4b4fee25a
      size: 1385
    params:
      params.yaml:
        base:
          log_level: INFO
          raw_data_path: data/raw
          temp_data_path: data/temp
          processed_data_path: data/processed
        load_data:
          train: train.parquet
          test: test.parquet
          columns:
          - PULocationID
          - DOLocationID
          - tpep_pickup_datetime
          - tpep_dropoff_datetime
          - passenger_count
          - trip_distance
          - fare_amount
    outs:
    - path: data/temp/test.feather
      md5: e841cd35ca4a8f91ceb3f60888953191
      size: 65354914
    - path: data/temp/train.feather
      md5: 2b18b2a97a4f52e4058dbded26b61958
      size: 76535642
  preprocess:
    cmd: python src/preprocess_data.py --config params.yaml
    deps:
    - path: data/temp/
      md5: fd0b772273da70523016df18a4f9b2db.dir
      size: 141890585
      nfiles: 3
    - path: src/preprocess_data.py
      md5: 6a20f5e92051bfe2c62b9f0330ecd5b2
      size: 3035
    params:
      params.yaml:
        base:
          log_level: INFO
          raw_data_path: data/raw
          temp_data_path: data/temp
          processed_data_path: data/processed
        preprocess:
          drop_outliers: false
          create_dt_features: true
          max_trip_distance: 300
          min_trip_duration: 1
          max_trip_duration: 180
          max_avg_trip_speed: 200
          min_fare_amount: 0
    outs:
    - path: data/processed/test.feather
      md5: f72254764e8878d1ac736f71ce6d517e
      size: 64912610
    - path: data/processed/train.feather
      md5: 2f973d1cd804421a461d186ef238e511
      size: 68314098
